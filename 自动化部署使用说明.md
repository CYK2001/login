# Flask应用自动化部署使用说明

本说明将指导您如何使用`deploy.py`脚本自动将Flask登录系统部署到互联网（Render平台）。

## 一、准备工作

### 1.1 安装必要的依赖

确保您的系统已安装以下软件：

- Python 3.6+：https://www.python.org/downloads/
- Git：https://git-scm.com/downloads

### 1.2 创建GitHub账号和Token

1. 访问[GitHub官网](https://github.com/)注册账号（如果还没有）
2. 登录后，点击右上角头像 -> Settings -> Developer settings -> Personal access tokens -> Fine-grained tokens
3. 点击"Generate new token"
4. 设置token名称，选择过期时间
5. 授予"Repository permissions"中的"Contents"和"Metadata"权限
6. 点击"Generate token"
7. **保存好这个token，稍后会用到**

### 1.3 创建Render账号和Token

1. 访问[Render官网](https://render.com/)注册账号（如果还没有）
2. 登录后，点击右上角头像 -> Account Settings -> API Keys
3. 点击"Create API Key"
4. 设置API Key名称
5. 点击"Create API Key"
6. **保存好这个API Key，稍后会用到**

### 1.4 准备数据库

您需要一个MySQL数据库。有以下几个选择：

#### 选项1：使用Render的免费MySQL数据库

1. 登录Render控制台
2. 点击"New" -> "Database"
3. 选择"MySQL"
4. 设置数据库名称
5. 选择"Free"计划
6. 点击"Create Database"
7. 等待数据库创建完成，记录下数据库连接信息

#### 选项2：使用其他免费MySQL服务

例如：
- [FreeMySQLHosting.net](https://freemysqlhosting.net/)
- [db4free.net](https://www.db4free.net/)

### 1.5 配置环境变量

创建一个`.env`文件，包含以下配置：

```
# 数据库配置
MYSQL_HOST=your_mysql_host
MYSQL_USER=your_mysql_username
MYSQL_PASSWORD=your_mysql_password
MYSQL_DB=your_database_name
MYSQL_PORT=3306

# Flask配置
FLASK_ENV=production
FLASK_SECRET_KEY=your_secure_secret_key
```

## 二、使用自动化部署脚本

### 2.1 运行部署脚本

1. 打开命令行工具（PowerShell或CMD）
2. 进入项目目录：
   ```powershell
   cd f:\Work\Login
   ```
3. 激活虚拟环境（可选）：
   ```powershell
   venv\Scripts\Activate.ps1
   ```
4. 运行部署脚本：
   ```powershell
   python deploy.py
   ```

### 2.2 脚本执行流程

脚本将引导您完成以下步骤：

1. **输入GitHub仓库名称**：为您的项目在GitHub上创建的仓库名称
2. **输入GitHub Personal Access Token**：您在步骤1.2中创建的GitHub Token
3. **输入Render API Token**：您在步骤1.3中创建的Render API Key
4. **输入Render服务名称**：为您的应用在Render上创建的服务名称（默认为login-system）

### 2.3 脚本执行内容

脚本将自动执行以下操作：

1. 创建/更新`.gitignore`文件
2. 创建`Procfile`文件（如果不存在）
3. 初始化Git仓库（如果不存在）
4. 在GitHub上创建新仓库
5. 将代码提交并推送到GitHub
6. 在Render上创建Web服务
7. 配置基本的环境变量

## 三、完成部署

### 3.1 配置数据库连接

脚本执行完成后，您需要在Render控制台中配置数据库连接信息：

1. 登录Render控制台
2. 找到您刚创建的服务
3. 点击"Environment"选项卡
4. 点击"Add Environment Variable"
5. 添加以下数据库连接环境变量：
   - `MYSQL_HOST`
   - `MYSQL_USER`
   - `MYSQL_PASSWORD`
   - `MYSQL_DB`
   - `MYSQL_PORT`
6. 点击"Save Changes"
7. 点击"Manual Deploy" -> "Deploy latest commit"重新部署应用

### 3.2 验证部署

1. 等待部署完成（通常需要1-2分钟）
2. 访问Render提供的应用URL（格式：https://your-service-name.onrender.com）
3. 测试登录功能，确保应用正常运行

## 四、常见问题和解决方案

### 4.1 GitHub Token权限不足

**问题**：脚本执行时显示"GitHub仓库创建失败"或"Permission denied"

**解决方案**：确保您的GitHub Token具有以下权限：
- `Repository permissions` -> `Contents` -> `Read and write`
- `Repository permissions` -> `Metadata` -> `Read-only`

### 4.2 Render API Token无效

**问题**：脚本执行时显示"Render服务创建失败"

**解决方案**：
1. 确保您的Render API Token是最新创建的
2. 检查Token是否有拼写错误
3. 确保您的Render账号已经验证了邮箱

### 4.3 数据库连接失败

**问题**：应用部署成功，但无法连接数据库

**解决方案**：
1. 检查Render控制台中的环境变量是否正确
2. 确保数据库服务器允许来自Render的连接
3. 检查数据库用户名、密码和数据库名称是否正确

### 4.4 应用无法启动

**问题**：部署失败，Render控制台显示错误信息

**解决方案**：
1. 查看Render控制台中的"Logs"选项卡，了解具体错误信息
2. 常见错误：
   - 依赖安装失败：检查`requirements.txt`文件
   - 应用启动命令错误：检查`Procfile`文件
   - 环境变量缺失：检查环境变量配置

## 五、手动部署步骤（备选方案）

如果自动化脚本执行失败，您可以尝试手动部署：

### 5.1 手动部署到Render

1. 登录Render控制台
2. 点击"New" -> "Web Service"
3. 连接您的GitHub仓库
4. 配置构建命令：`pip install -r requirements.txt`
5. 配置启动命令：`gunicorn app:app`
6. 点击"Create Web Service"
7. 配置环境变量（包括数据库连接信息）
8. 等待部署完成

### 5.2 手动部署到其他平台

请参考`免费部署指南.md`文件中的详细步骤。

## 六、后续维护

### 6.1 代码更新

当您修改代码后，只需将代码推送到GitHub，Render会自动重新部署应用：

```powershell
git add .
git commit -m "Update application"
git push origin main
```

### 6.2 数据库备份

定期备份您的数据库，以防止数据丢失。

### 6.3 监控应用

通过Render控制台的"Logs"选项卡监控应用运行状态，及时发现和解决问题。

## 七、注意事项

1. **免费计划限制**：Render的免费计划有以下限制：
   - 应用在空闲30分钟后会自动休眠
   - 每月有100GB的带宽限制
   - 数据库有512MB的存储空间限制

2. **安全考虑**：
   - 不要在代码中硬编码敏感信息
   - 使用强密码和密钥
   - 定期更新依赖包，修复安全漏洞

3. **性能优化**：
   - 对于生产环境，考虑升级到付费计划
   - 优化数据库查询
   - 使用缓存机制

如果您在使用过程中遇到任何问题，请参考各平台的官方文档或在社区寻求帮助。
