# 部署文档

## 1. 系统要求

- **操作系统**: Windows 10/Server 2012及以上，或Linux系统
- **Python版本**: Python 3.8及以上
- **数据库**: MySQL 5.7及以上
- **Web服务器**: 可选择Nginx或Apache（生产环境推荐）
- **其他依赖**: Git（用于代码获取）

## 2. 环境准备

### 2.1 安装Python

1. 下载Python安装包：https://www.python.org/downloads/
2. 安装Python，确保勾选"Add Python to PATH"
3. 验证安装：
   ```bash
   python --version
   pip --version
   ```

### 2.2 安装MySQL

1. 下载MySQL安装包：https://dev.mysql.com/downloads/mysql/
2. 安装MySQL，设置root密码
3. 创建数据库：
   ```sql
   CREATE DATABASE login_system CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```

## 3. 代码获取

```bash
git clone <repository-url>
cd login_system
```

## 4. 安装依赖

```bash
pip install -r requirements.txt
```

## 5. 配置文件

### 5.1 创建配置文件

在项目根目录创建`.env`文件，添加以下内容：

```env
# 数据库配置
MYSQL_HOST=localhost
MYSQL_USER=root
MYSQL_PASSWORD=your-mysql-password
MYSQL_DB=login_system

# 应用配置
SECRET_KEY=your-secret-key
DEBUG=False
```

### 5.2 数据库初始化

运行数据库初始化脚本（如果有）：

```bash
python init_db.py
```

## 6. 运行应用

### 6.1 开发环境运行

```bash
python app.py
```

应用将在 http://localhost:5000 上运行

### 6.2 生产环境运行

#### 6.2.1 使用Gunicorn（Linux）

```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 app:app
```

#### 6.2.2 使用Waitress（Windows）

```bash
pip install waitress
waitress-serve --host=0.0.0.0 --port=5000 app:app
```

### 6.3 使用Nginx作为反向代理

配置Nginx：

```nginx
server {
    listen 80;
    server_name example.com;

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /static {
        alias /path/to/login_system/app/static;
        expires 30d;
    }
}
```

### 6.4 使用Supervisor管理进程（Linux）

配置Supervisor：

```ini
[program:login_system]
command=/path/to/venv/bin/gunicorn -w 4 -b 0.0.0.0:5000 app:app
directory=/path/to/login_system
autostart=true
autorestart=true
user=www-data
redirect_stderr=true
stdout_logfile=/var/log/supervisor/login_system.log
```

## 7. 定时任务配置

应用内置了定时任务，包括：
- 清理旧导出文件
- 打包日志文件
- 清理旧日志文件
- 清理旧数据库日志
- 导出审计日志

这些任务将在应用启动时自动启动。

## 8. 安全配置

### 8.1 生产环境安全建议

1. 设置强密码的MySQL用户
2. 定期备份数据库
3. 启用HTTPS
4. 限制SSH访问
5. 定期更新系统和依赖包
6. 配置防火墙，只允许必要的端口访问

### 8.2 应用安全配置

1. 设置复杂的SECRET_KEY
2. 关闭DEBUG模式
3. 配置正确的CORS策略
4. 定期清理审计日志
5. 限制上传文件的大小和类型

## 9. 常见问题和解决方案

### 9.1 数据库连接失败

- 检查数据库配置是否正确
- 确保MySQL服务正在运行
- 检查数据库用户权限

### 9.2 应用启动失败

- 检查端口是否被占用
- 检查依赖包是否安装正确
- 查看日志文件获取详细错误信息

### 9.3 登录失败

- 检查用户名和密码是否正确
- 检查验证码是否正确
- 查看审计日志获取详细错误信息

## 10. 维护和更新

### 10.1 备份数据

定期备份数据库：

```bash
mysqldump -u root -p login_system > backup.sql
```

### 10.2 更新应用

```bash
git pull
pip install -r requirements.txt
python app.py  # 或重启生产环境服务
```

### 10.3 日志管理

- 应用日志：`logs/app.log`
- 访问日志：由Web服务器记录
- 审计日志：存储在数据库中，可通过管理界面查看和导出

## 11. 联系方式

如有任何问题，请联系系统管理员。
